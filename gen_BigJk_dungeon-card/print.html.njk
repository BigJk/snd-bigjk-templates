<script type="module" crossorigin>
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=i(n);fetch(n.href,o)}})();var Ge=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},K={},qe={get exports(){return K},set exports(e){K=e}},L={},Ue={get exports(){return L},set exports(e){L=e}},fe={},Qe={get exports(){return fe},set exports(e){fe=e}};(function(e){(function(){var t,i,r,n,o,s,l,d,u,g,v,A,m,W,b;r=Math.floor,g=Math.min,i=function(f,h){return f<h?-1:f>h?1:0},u=function(f,h,p,k,w){var M;if(p==null&&(p=0),w==null&&(w=i),p<0)throw new Error("lo must be non-negative");for(k==null&&(k=f.length);p<k;)M=r((p+k)/2),w(h,f[M])<0?k=M:p=M+1;return[].splice.apply(f,[p,p-p].concat(h)),h},s=function(f,h,p){return p==null&&(p=i),f.push(h),W(f,0,f.length-1,p)},o=function(f,h){var p,k;return h==null&&(h=i),p=f.pop(),f.length?(k=f[0],f[0]=p,b(f,0,h)):k=p,k},d=function(f,h,p){var k;return p==null&&(p=i),k=f[0],f[0]=h,b(f,0,p),k},l=function(f,h,p){var k;return p==null&&(p=i),f.length&&p(f[0],h)<0&&(k=[f[0],h],h=k[0],f[0]=k[1],b(f,0,p)),h},n=function(f,h){var p,k,w,M,y,N;for(h==null&&(h=i),M=function(){N=[];for(var S=0,O=r(f.length/2);0<=O?S<O:S>O;0<=O?S++:S--)N.push(S);return N}.apply(this).reverse(),y=[],k=0,w=M.length;k<w;k++)p=M[k],y.push(b(f,p,h));return y},m=function(f,h,p){var k;if(p==null&&(p=i),k=f.indexOf(h),k!==-1)return W(f,0,k,p),b(f,k,p)},v=function(f,h,p){var k,w,M,y,N;if(p==null&&(p=i),w=f.slice(0,h),!w.length)return w;for(n(w,p),N=f.slice(h),M=0,y=N.length;M<y;M++)k=N[M],l(w,k,p);return w.sort(p).reverse()},A=function(f,h,p){var k,w,M,y,N,S,O,$,ne;if(p==null&&(p=i),h*10<=f.length){if(M=f.slice(0,h).sort(p),!M.length)return M;for(w=M[M.length-1],O=f.slice(h),y=0,S=O.length;y<S;y++)k=O[y],p(k,w)<0&&(u(M,k,0,null,p),M.pop(),w=M[M.length-1]);return M}for(n(f,p),ne=[],N=0,$=g(h,f.length);0<=$?N<$:N>$;0<=$?++N:--N)ne.push(o(f,p));return ne},W=function(f,h,p,k){var w,M,y;for(k==null&&(k=i),w=f[p];p>h;){if(y=p-1>>1,M=f[y],k(w,M)<0){f[p]=M,p=y;continue}break}return f[p]=w},b=function(f,h,p){var k,w,M,y,N;for(p==null&&(p=i),w=f.length,N=h,M=f[h],k=2*h+1;k<w;)y=k+1,y<w&&!(p(f[k],f[y])<0)&&(k=y),f[h]=f[k],h=k,k=2*h+1;return f[h]=M,W(f,N,h,p)},t=function(){f.push=s,f.pop=o,f.replace=d,f.pushpop=l,f.heapify=n,f.updateItem=m,f.nlargest=v,f.nsmallest=A;function f(h){this.cmp=h??i,this.nodes=[]}return f.prototype.push=function(h){return s(this.nodes,h,this.cmp)},f.prototype.pop=function(){return o(this.nodes,this.cmp)},f.prototype.peek=function(){return this.nodes[0]},f.prototype.contains=function(h){return this.nodes.indexOf(h)!==-1},f.prototype.replace=function(h){return d(this.nodes,h,this.cmp)},f.prototype.pushpop=function(h){return l(this.nodes,h,this.cmp)},f.prototype.heapify=function(){return n(this.nodes,this.cmp)},f.prototype.updateItem=function(h){return m(this.nodes,h,this.cmp)},f.prototype.clear=function(){return this.nodes=[]},f.prototype.empty=function(){return this.nodes.length===0},f.prototype.size=function(){return this.nodes.length},f.prototype.clone=function(){var h;return h=new f,h.nodes=this.nodes.slice(0),h},f.prototype.toArray=function(){return this.nodes.slice(0)},f.prototype.insert=f.prototype.push,f.prototype.top=f.prototype.peek,f.prototype.front=f.prototype.peek,f.prototype.has=f.prototype.contains,f.prototype.copy=f.prototype.clone,f}(),e!==null&&e.exports?e.exports=t:window.Heap=t}).call(Ge)})(Qe);(function(e){e.exports=fe})(Ue);function Ve(e,t,i){this.x=e,this.y=t,this.walkable=i===void 0?!0:i}var ge=Ve,Ye={Always:1,Never:2,IfAtMostOneObstacle:3,OnlyWhenNoObstacles:4},I=Ye,Fe=ge,U=I;function B(e,t,i){var r;typeof e!="object"?r=e:(t=e.length,r=e[0].length,i=e),this.width=r,this.height=t,this.nodes=this._buildNodes(r,t,i)}B.prototype._buildNodes=function(e,t,i){var r,n,o=new Array(t);for(r=0;r<t;++r)for(o[r]=new Array(e),n=0;n<e;++n)o[r][n]=new Fe(n,r);if(i===void 0)return o;if(i.length!==t||i[0].length!==e)throw new Error("Matrix size does not fit");for(r=0;r<t;++r)for(n=0;n<e;++n)i[r][n]&&(o[r][n].walkable=!1);return o};B.prototype.getNodeAt=function(e,t){return this.nodes[t][e]};B.prototype.isWalkableAt=function(e,t){return this.isInside(e,t)&&this.nodes[t][e].walkable};B.prototype.isInside=function(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height};B.prototype.setWalkableAt=function(e,t,i){this.nodes[t][e].walkable=i};B.prototype.getNeighbors=function(e,t){var i=e.x,r=e.y,n=[],o=!1,s=!1,l=!1,d=!1,u=!1,g=!1,v=!1,A=!1,m=this.nodes;if(this.isWalkableAt(i,r-1)&&(n.push(m[r-1][i]),o=!0),this.isWalkableAt(i+1,r)&&(n.push(m[r][i+1]),l=!0),this.isWalkableAt(i,r+1)&&(n.push(m[r+1][i]),u=!0),this.isWalkableAt(i-1,r)&&(n.push(m[r][i-1]),v=!0),t===U.Never)return n;if(t===U.OnlyWhenNoObstacles)s=v&&o,d=o&&l,g=l&&u,A=u&&v;else if(t===U.IfAtMostOneObstacle)s=v||o,d=o||l,g=l||u,A=u||v;else if(t===U.Always)s=!0,d=!0,g=!0,A=!0;else throw new Error("Incorrect value of diagonalMovement");return s&&this.isWalkableAt(i-1,r-1)&&n.push(m[r-1][i-1]),d&&this.isWalkableAt(i+1,r-1)&&n.push(m[r-1][i+1]),g&&this.isWalkableAt(i+1,r+1)&&n.push(m[r+1][i+1]),A&&this.isWalkableAt(i-1,r+1)&&n.push(m[r+1][i-1]),n};B.prototype.clone=function(){var e,t,i=this.width,r=this.height,n=this.nodes,o=new B(i,r),s=new Array(r);for(e=0;e<r;++e)for(s[e]=new Array(i),t=0;t<i;++t)s[e][t]=new Fe(t,e,n[e][t].walkable);return o.nodes=s,o};var Ke=B,_={};function ue(e){for(var t=[[e.x,e.y]];e.parent;)e=e.parent,t.push([e.x,e.y]);return t.reverse()}_.backtrace=ue;function Ze(e,t){var i=ue(e),r=ue(t);return i.concat(r.reverse())}_.biBacktrace=Ze;function Xe(e){var t,i=0,r,n,o,s;for(t=1;t<e.length;++t)r=e[t-1],n=e[t],o=r[0]-n[0],s=r[1]-n[1],i+=Math.sqrt(o*o+s*s);return i}_.pathLength=Xe;function be(e,t,i,r){var n=Math.abs,o=[],s,l,d,u,g,v;for(d=n(i-e),u=n(r-t),s=e<i?1:-1,l=t<r?1:-1,g=d-u;o.push([e,t]),!(e===i&&t===r);)v=2*g,v>-u&&(g=g-u,e=e+s),v<d&&(g=g+d,t=t+l);return o}_.interpolate=be;function et(e){var t=[],i=e.length,r,n,o,s,l,d;if(i<2)return t;for(l=0;l<i-1;++l)for(r=e[l],n=e[l+1],o=be(r[0],r[1],n[0],n[1]),s=o.length,d=0;d<s-1;++d)t.push(o[d]);return t.push(e[i-1]),t}_.expandPath=et;function tt(e,t){var i=t.length,r=t[0][0],n=t[0][1],o=t[i-1][0],s=t[i-1][1],l,d,u,g,v,A,m,W,b,f,h;for(l=r,d=n,v=[[l,d]],A=2;A<i;++A){for(W=t[A],u=W[0],g=W[1],b=be(l,d,u,g),h=!1,m=1;m<b.length;++m)if(f=b[m],!e.isWalkableAt(f[0],f[1])){h=!0;break}h&&(lastValidCoord=t[A-1],v.push(lastValidCoord),l=lastValidCoord[0],d=lastValidCoord[1])}return v.push([o,s]),v}_.smoothenPath=tt;function it(e){if(e.length<3)return e;var t=[],i=e[0][0],r=e[0][1],n=e[1][0],o=e[1][1],s=n-i,l=o-r,d,u,g,v,A,m;for(A=Math.sqrt(s*s+l*l),s/=A,l/=A,t.push([i,r]),m=2;m<e.length;m++)d=n,u=o,g=s,v=l,n=e[m][0],o=e[m][1],s=n-d,l=o-u,A=Math.sqrt(s*s+l*l),s/=A,l/=A,(s!==g||l!==v)&&t.push([d,u]);return t.push([n,o]),t}_.compressPath=it;var q={manhattan:function(e,t){return e+t},euclidean:function(e,t){return Math.sqrt(e*e+t*t)},octile:function(e,t){var i=Math.SQRT2-1;return e<t?i*e+t:i*t+e},chebyshev:function(e,t){return Math.max(e,t)}},nt=L,rt=_,re=q,Q=I;function Pe(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.heuristic=e.heuristic||re.manhattan,this.weight=e.weight||1,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=Q.OnlyWhenNoObstacles:this.diagonalMovement=Q.IfAtMostOneObstacle:this.diagonalMovement=Q.Never),this.diagonalMovement===Q.Never?this.heuristic=e.heuristic||re.manhattan:this.heuristic=e.heuristic||re.octile}Pe.prototype.findPath=function(e,t,i,r,n){var o=new nt(function(M,y){return M.f-y.f}),s=n.getNodeAt(e,t),l=n.getNodeAt(i,r),d=this.heuristic,u=this.diagonalMovement,g=this.weight,v=Math.abs,A=Math.SQRT2,m,W,b,f,h,p,k,w;for(s.g=0,s.f=0,o.push(s),s.opened=!0;!o.empty();){if(m=o.pop(),m.closed=!0,m===l)return rt.backtrace(l);for(W=n.getNeighbors(m,u),f=0,h=W.length;f<h;++f)b=W[f],!b.closed&&(p=b.x,k=b.y,w=m.g+(p-m.x===0||k-m.y===0?1:A),(!b.opened||w<b.g)&&(b.g=w,b.h=b.h||g*d(v(p-i),v(k-r)),b.f=b.g+b.h,b.parent=m,b.opened?o.updateItem(b):(o.push(b),b.opened=!0)))}return[]};var ve=Pe,_e=ve;function Z(e){_e.call(this,e);var t=this.heuristic;this.heuristic=function(i,r){return t(i,r)*1e6}}Z.prototype=new _e;Z.prototype.constructor=Z;var ot=Z,st=_,oe=I;function Oe(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=oe.OnlyWhenNoObstacles:this.diagonalMovement=oe.IfAtMostOneObstacle:this.diagonalMovement=oe.Never)}Oe.prototype.findPath=function(e,t,i,r,n){var o=[],s=this.diagonalMovement,l=n.getNodeAt(e,t),d=n.getNodeAt(i,r),u,g,v,A,m;for(o.push(l),l.opened=!0;o.length;){if(v=o.shift(),v.closed=!0,v===d)return st.backtrace(d);for(u=n.getNeighbors(v,s),A=0,m=u.length;A<m;++A)g=u[A],!(g.closed||g.opened)&&(o.push(g),g.opened=!0,g.parent=v)}return[]};var lt=Oe,Ie=ve;function X(e){Ie.call(this,e),this.heuristic=function(t,i){return 0}}X.prototype=new Ie;X.prototype.constructor=X;var at=X,ke=L,Me=_,se=q,V=I;function Te(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.heuristic=e.heuristic||se.manhattan,this.weight=e.weight||1,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=V.OnlyWhenNoObstacles:this.diagonalMovement=V.IfAtMostOneObstacle:this.diagonalMovement=V.Never),this.diagonalMovement===V.Never?this.heuristic=e.heuristic||se.manhattan:this.heuristic=e.heuristic||se.octile}Te.prototype.findPath=function(e,t,i,r,n){var o=function(O,$){return O.f-$.f},s=new ke(o),l=new ke(o),d=n.getNodeAt(e,t),u=n.getNodeAt(i,r),g=this.heuristic,v=this.diagonalMovement,A=this.weight,m=Math.abs,W=Math.SQRT2,b,f,h,p,k,w,M,y,N=1,S=2;for(d.g=0,d.f=0,s.push(d),d.opened=N,u.g=0,u.f=0,l.push(u),u.opened=S;!s.empty()&&!l.empty();){for(b=s.pop(),b.closed=!0,f=n.getNeighbors(b,v),p=0,k=f.length;p<k;++p)if(h=f[p],!h.closed){if(h.opened===S)return Me.biBacktrace(b,h);w=h.x,M=h.y,y=b.g+(w-b.x===0||M-b.y===0?1:W),(!h.opened||y<h.g)&&(h.g=y,h.h=h.h||A*g(m(w-i),m(M-r)),h.f=h.g+h.h,h.parent=b,h.opened?s.updateItem(h):(s.push(h),h.opened=N))}for(b=l.pop(),b.closed=!0,f=n.getNeighbors(b,v),p=0,k=f.length;p<k;++p)if(h=f[p],!h.closed){if(h.opened===N)return Me.biBacktrace(h,b);w=h.x,M=h.y,y=b.g+(w-b.x===0||M-b.y===0?1:W),(!h.opened||y<h.g)&&(h.g=y,h.h=h.h||A*g(m(w-e),m(M-t)),h.f=h.g+h.h,h.parent=b,h.opened?l.updateItem(h):(l.push(h),h.opened=S))}}return[]};var me=Te,Ce=me;function ee(e){Ce.call(this,e);var t=this.heuristic;this.heuristic=function(i,r){return t(i,r)*1e6}}ee.prototype=new Ce;ee.prototype.constructor=ee;var ht=ee,we=_,le=I;function Be(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=le.OnlyWhenNoObstacles:this.diagonalMovement=le.IfAtMostOneObstacle:this.diagonalMovement=le.Never)}Be.prototype.findPath=function(e,t,i,r,n){var o=n.getNodeAt(e,t),s=n.getNodeAt(i,r),l=[],d=[],u,g,v,A=this.diagonalMovement,m=0,W=1,b,f;for(l.push(o),o.opened=!0,o.by=m,d.push(s),s.opened=!0,s.by=W;l.length&&d.length;){for(v=l.shift(),v.closed=!0,u=n.getNeighbors(v,A),b=0,f=u.length;b<f;++b)if(g=u[b],!g.closed){if(g.opened){if(g.by===W)return we.biBacktrace(v,g);continue}l.push(g),g.parent=v,g.opened=!0,g.by=m}for(v=d.shift(),v.closed=!0,u=n.getNeighbors(v,A),b=0,f=u.length;b<f;++b)if(g=u[b],!g.closed){if(g.opened){if(g.by===m)return we.biBacktrace(g,v);continue}d.push(g),g.parent=v,g.opened=!0,g.by=W}}return[]};var ft=Be,$e=me;function te(e){$e.call(this,e),this.heuristic=function(t,i){return 0}}te.prototype=new $e;te.prototype.constructor=te;var ut=te,ae=q,ye=ge,Y=I;function Re(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.heuristic=e.heuristic||ae.manhattan,this.weight=e.weight||1,this.trackRecursion=e.trackRecursion||!1,this.timeLimit=e.timeLimit||1/0,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=Y.OnlyWhenNoObstacles:this.diagonalMovement=Y.IfAtMostOneObstacle:this.diagonalMovement=Y.Never),this.diagonalMovement===Y.Never?this.heuristic=e.heuristic||ae.manhattan:this.heuristic=e.heuristic||ae.octile}Re.prototype.findPath=function(e,t,i,r,n){var o=new Date().getTime(),s=function(b,f){return this.heuristic(Math.abs(f.x-b.x),Math.abs(f.y-b.y))}.bind(this),l=function(b,f){return b.x===f.x||b.y===f.y?1:Math.SQRT2},d=function(b,f,h,p,k){if(this.timeLimit>0&&new Date().getTime()-o>this.timeLimit*1e3)return 1/0;var w=f+s(b,g)*this.weight;if(w>h)return w;if(b==g)return p[k]=[b.x,b.y],b;var M,y,N,S,O=n.getNeighbors(b,this.diagonalMovement);for(N=0,M=1/0;S=O[N];++N){if(this.trackRecursion&&(S.retainCount=S.retainCount+1||1,S.tested!==!0&&(S.tested=!0)),y=d(S,f+l(b,S),h,p,k+1),y instanceof ye)return p[k]=[b.x,b.y],y;this.trackRecursion&&--S.retainCount===0&&(S.tested=!1),y<M&&(M=y)}return M}.bind(this),u=n.getNodeAt(e,t),g=n.getNodeAt(i,r),v=s(u,g),A,m,W;for(A=0;;++A){if(m=[],W=d(u,0,v,m,0),W===1/0)return[];if(W instanceof ye)return m;v=W}return[]};var dt=Re,ct=L,We=_,je=q;function Ae(e){e=e||{},this.heuristic=e.heuristic||je.manhattan,this.trackJumpRecursion=e.trackJumpRecursion||!1}Ae.prototype.findPath=function(e,t,i,r,n){var o=this.openList=new ct(function(u,g){return u.f-g.f}),s=this.startNode=n.getNodeAt(e,t),l=this.endNode=n.getNodeAt(i,r),d;for(this.grid=n,s.g=0,s.f=0,o.push(s),s.opened=!0;!o.empty();){if(d=o.pop(),d.closed=!0,d===l)return We.expandPath(We.backtrace(l));this._identifySuccessors(d)}return[]};Ae.prototype._identifySuccessors=function(e){var t=this.grid,i=this.heuristic,r=this.openList,n=this.endNode.x,o=this.endNode.y,s,l,d,u,g,v=e.x,A=e.y,m,W,b,f,h,p=Math.abs;for(s=this._findNeighbors(e),u=0,g=s.length;u<g;++u)if(l=s[u],d=this._jump(l[0],l[1],v,A),d){if(m=d[0],W=d[1],h=t.getNodeAt(m,W),h.closed)continue;b=je.octile(p(m-v),p(W-A)),f=e.g+b,(!h.opened||f<h.g)&&(h.g=f,h.h=h.h||i(p(m-n),p(W-o)),h.f=h.g+h.h,h.parent=e,h.opened?r.updateItem(h):(r.push(h),h.opened=!0))}};var ie=Ae,Le=ie,pt=I;function H(e){Le.call(this,e)}H.prototype=new Le;H.prototype.constructor=H;H.prototype._jump=function(e,t,i,r){var n=this.grid,o=e-i,s=t-r;if(!n.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(n.getNodeAt(e,t).tested=!0),n.getNodeAt(e,t)===this.endNode)return[e,t];if(o!==0){if(n.isWalkableAt(e,t-1)&&!n.isWalkableAt(e-o,t-1)||n.isWalkableAt(e,t+1)&&!n.isWalkableAt(e-o,t+1))return[e,t]}else if(s!==0){if(n.isWalkableAt(e-1,t)&&!n.isWalkableAt(e-1,t-s)||n.isWalkableAt(e+1,t)&&!n.isWalkableAt(e+1,t-s))return[e,t];if(this._jump(e+1,t,e,t)||this._jump(e-1,t,e,t))return[e,t]}else throw new Error("Only horizontal and vertical movements are allowed");return this._jump(e+o,t+s,e,t)};H.prototype._findNeighbors=function(e){var t=e.parent,i=e.x,r=e.y,n=this.grid,o,s,l,d,u=[],g,v,A,m;if(t)o=t.x,s=t.y,l=(i-o)/Math.max(Math.abs(i-o),1),d=(r-s)/Math.max(Math.abs(r-s),1),l!==0?(n.isWalkableAt(i,r-1)&&u.push([i,r-1]),n.isWalkableAt(i,r+1)&&u.push([i,r+1]),n.isWalkableAt(i+l,r)&&u.push([i+l,r])):d!==0&&(n.isWalkableAt(i-1,r)&&u.push([i-1,r]),n.isWalkableAt(i+1,r)&&u.push([i+1,r]),n.isWalkableAt(i,r+d)&&u.push([i,r+d]));else for(g=n.getNeighbors(e,pt.Never),A=0,m=g.length;A<m;++A)v=g[A],u.push([v.x,v.y]);return u};var gt=H,He=ie,bt=I;function z(e){He.call(this,e)}z.prototype=new He;z.prototype.constructor=z;z.prototype._jump=function(e,t,i,r){var n=this.grid,o=e-i,s=t-r;if(!n.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(n.getNodeAt(e,t).tested=!0),n.getNodeAt(e,t)===this.endNode)return[e,t];if(o!==0&&s!==0){if(n.isWalkableAt(e-o,t+s)&&!n.isWalkableAt(e-o,t)||n.isWalkableAt(e+o,t-s)&&!n.isWalkableAt(e,t-s))return[e,t];if(this._jump(e+o,t,e,t)||this._jump(e,t+s,e,t))return[e,t]}else if(o!==0){if(n.isWalkableAt(e+o,t+1)&&!n.isWalkableAt(e,t+1)||n.isWalkableAt(e+o,t-1)&&!n.isWalkableAt(e,t-1))return[e,t]}else if(n.isWalkableAt(e+1,t+s)&&!n.isWalkableAt(e+1,t)||n.isWalkableAt(e-1,t+s)&&!n.isWalkableAt(e-1,t))return[e,t];return this._jump(e+o,t+s,e,t)};z.prototype._findNeighbors=function(e){var t=e.parent,i=e.x,r=e.y,n=this.grid,o,s,l,d,u=[],g,v,A,m;if(t)o=t.x,s=t.y,l=(i-o)/Math.max(Math.abs(i-o),1),d=(r-s)/Math.max(Math.abs(r-s),1),l!==0&&d!==0?(n.isWalkableAt(i,r+d)&&u.push([i,r+d]),n.isWalkableAt(i+l,r)&&u.push([i+l,r]),n.isWalkableAt(i+l,r+d)&&u.push([i+l,r+d]),n.isWalkableAt(i-l,r)||u.push([i-l,r+d]),n.isWalkableAt(i,r-d)||u.push([i+l,r-d])):l===0?(n.isWalkableAt(i,r+d)&&u.push([i,r+d]),n.isWalkableAt(i+1,r)||u.push([i+1,r+d]),n.isWalkableAt(i-1,r)||u.push([i-1,r+d])):(n.isWalkableAt(i+l,r)&&u.push([i+l,r]),n.isWalkableAt(i,r+1)||u.push([i+l,r+1]),n.isWalkableAt(i,r-1)||u.push([i+l,r-1]));else for(g=n.getNeighbors(e,bt.Always),A=0,m=g.length;A<m;++A)v=g[A],u.push([v.x,v.y]);return u};var vt=z,ze=ie,mt=I;function E(e){ze.call(this,e)}E.prototype=new ze;E.prototype.constructor=E;E.prototype._jump=function(e,t,i,r){var n=this.grid,o=e-i,s=t-r;if(!n.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(n.getNodeAt(e,t).tested=!0),n.getNodeAt(e,t)===this.endNode)return[e,t];if(o!==0&&s!==0){if(this._jump(e+o,t,e,t)||this._jump(e,t+s,e,t))return[e,t]}else if(o!==0){if(n.isWalkableAt(e,t-1)&&!n.isWalkableAt(e-o,t-1)||n.isWalkableAt(e,t+1)&&!n.isWalkableAt(e-o,t+1))return[e,t]}else if(s!==0&&(n.isWalkableAt(e-1,t)&&!n.isWalkableAt(e-1,t-s)||n.isWalkableAt(e+1,t)&&!n.isWalkableAt(e+1,t-s)))return[e,t];return n.isWalkableAt(e+o,t)&&n.isWalkableAt(e,t+s)?this._jump(e+o,t+s,e,t):null};E.prototype._findNeighbors=function(e){var t=e.parent,i=e.x,r=e.y,n=this.grid,o,s,l,d,u=[],g,v,A,m;if(t)if(o=t.x,s=t.y,l=(i-o)/Math.max(Math.abs(i-o),1),d=(r-s)/Math.max(Math.abs(r-s),1),l!==0&&d!==0)n.isWalkableAt(i,r+d)&&u.push([i,r+d]),n.isWalkableAt(i+l,r)&&u.push([i+l,r]),n.isWalkableAt(i,r+d)&&n.isWalkableAt(i+l,r)&&u.push([i+l,r+d]);else{var W;if(l!==0){W=n.isWalkableAt(i+l,r);var b=n.isWalkableAt(i,r+1),f=n.isWalkableAt(i,r-1);W&&(u.push([i+l,r]),b&&u.push([i+l,r+1]),f&&u.push([i+l,r-1])),b&&u.push([i,r+1]),f&&u.push([i,r-1])}else if(d!==0){W=n.isWalkableAt(i,r+d);var h=n.isWalkableAt(i+1,r),p=n.isWalkableAt(i-1,r);W&&(u.push([i,r+d]),h&&u.push([i+1,r+d]),p&&u.push([i-1,r+d])),h&&u.push([i+1,r]),p&&u.push([i-1,r])}}else for(g=n.getNeighbors(e,mt.OnlyWhenNoObstacles),A=0,m=g.length;A<m;++A)v=g[A],u.push([v.x,v.y]);return u};var At=E,Ee=ie,kt=I;function J(e){Ee.call(this,e)}J.prototype=new Ee;J.prototype.constructor=J;J.prototype._jump=function(e,t,i,r){var n=this.grid,o=e-i,s=t-r;if(!n.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(n.getNodeAt(e,t).tested=!0),n.getNodeAt(e,t)===this.endNode)return[e,t];if(o!==0&&s!==0){if(n.isWalkableAt(e-o,t+s)&&!n.isWalkableAt(e-o,t)||n.isWalkableAt(e+o,t-s)&&!n.isWalkableAt(e,t-s))return[e,t];if(this._jump(e+o,t,e,t)||this._jump(e,t+s,e,t))return[e,t]}else if(o!==0){if(n.isWalkableAt(e+o,t+1)&&!n.isWalkableAt(e,t+1)||n.isWalkableAt(e+o,t-1)&&!n.isWalkableAt(e,t-1))return[e,t]}else if(n.isWalkableAt(e+1,t+s)&&!n.isWalkableAt(e+1,t)||n.isWalkableAt(e-1,t+s)&&!n.isWalkableAt(e-1,t))return[e,t];return n.isWalkableAt(e+o,t)||n.isWalkableAt(e,t+s)?this._jump(e+o,t+s,e,t):null};J.prototype._findNeighbors=function(e){var t=e.parent,i=e.x,r=e.y,n=this.grid,o,s,l,d,u=[],g,v,A,m;if(t)o=t.x,s=t.y,l=(i-o)/Math.max(Math.abs(i-o),1),d=(r-s)/Math.max(Math.abs(r-s),1),l!==0&&d!==0?(n.isWalkableAt(i,r+d)&&u.push([i,r+d]),n.isWalkableAt(i+l,r)&&u.push([i+l,r]),(n.isWalkableAt(i,r+d)||n.isWalkableAt(i+l,r))&&u.push([i+l,r+d]),!n.isWalkableAt(i-l,r)&&n.isWalkableAt(i,r+d)&&u.push([i-l,r+d]),!n.isWalkableAt(i,r-d)&&n.isWalkableAt(i+l,r)&&u.push([i+l,r-d])):l===0?n.isWalkableAt(i,r+d)&&(u.push([i,r+d]),n.isWalkableAt(i+1,r)||u.push([i+1,r+d]),n.isWalkableAt(i-1,r)||u.push([i-1,r+d])):n.isWalkableAt(i+l,r)&&(u.push([i+l,r]),n.isWalkableAt(i,r+1)||u.push([i+l,r+1]),n.isWalkableAt(i,r-1)||u.push([i+l,r-1]));else for(g=n.getNeighbors(e,kt.IfAtMostOneObstacle),A=0,m=g.length;A<m;++A)v=g[A],u.push([v.x,v.y]);return u};var Mt=J,he=I,wt=gt,yt=vt,Wt=At,Nt=Mt;function St(e){return e=e||{},e.diagonalMovement===he.Never?new wt(e):e.diagonalMovement===he.Always?new yt(e):e.diagonalMovement===he.OnlyWhenNoObstacles?new Wt(e):new Nt(e)}var Dt=St,Ft={Heap:L,Node:ge,Grid:Ke,Util:_,DiagonalMovement:I,Heuristic:q,AStarFinder:ve,BestFirstFinder:ot,BreadthFirstFinder:lt,DijkstraFinder:at,BiAStarFinder:me,BiBestFirstFinder:ht,BiBreadthFirstFinder:ft,BiDijkstraFinder:ut,IDAStarFinder:dt,JumpPointFinder:Dt};(function(e){e.exports=Ft})(qe);let R=document.querySelector(window.dungeonGenTarget??"#app canvas"),c=R.getContext("2d"),de=R.width,Ne=R.height;window.devicePixelRatio>1&&(R.width=de*window.devicePixelRatio,R.height=Ne*window.devicePixelRatio,R.style.width=de+"px",R.style.height=Ne+"px",c.scale(window.devicePixelRatio,window.devicePixelRatio));const T=15,C=25;console.log(T,C);const a=de/T,F=2.5,x=1.5,ce=1,Pt=1.5;console.log(a);function _t(e,t,i,r,n){let l=(u,g,v)=>(u-=15*r/2,g-=15*r/2,[u*Math.cos(v)-g*Math.sin(v)+15*r/2,u*Math.sin(v)+g*Math.cos(v)+15*r/2]),d=new Array(n).fill(null).map((u,g)=>[l(0,6*r*g,i),l(15*r,6*r*g,i)]);c.strokeStyle="#000000",c.lineWidth=Pt*r,d.forEach(u=>{c.beginPath(),c.moveTo(u[0][0]+e,u[0][1]+t),c.lineTo(u[1][0]+e,u[1][1]+t),c.stroke()})}function Ot(e,t,i,r,n,o,s){new PoissonDiskSampling({shape:[i,r],minDistance:13*ce,maxDistance:18*ce,tries:10}).fill().forEach(d=>{s&&!s(d)||_t(e+d[0],t+d[1],Math.PI*2*Math.random(),n,o)})}function pe(e,t,i,r,n,o){n=n??F,o=o??x,c.fillStyle="#ffffff",c.fillRect(e*a,t*a,i*a,r*a),c.lineWidth=o,c.strokeStyle="black",c.setLineDash([0,a/4,a/4]);for(let s=1;s<i;s++)c.beginPath(),c.moveTo(e*a+s*a,t*a),c.lineTo(e*a+s*a,t*a+r*a),c.stroke();for(let s=1;s<r;s++)c.beginPath(),c.moveTo(e*a,t*a+s*a),c.lineTo(e*a+i*a,t*a+s*a),c.stroke();c.setLineDash([]),c.strokeStyle="#000000",c.lineWidth=n,c.beginPath(),c.rect(e*a,t*a,i*a,r*a),c.stroke()}function It(e,t,i){pe(e,t,1,1),i.north&&(c.fillStyle="#ffffff",c.fillRect(e*a+F/2,t*a-F,a-F,F*2),c.lineWidth=x,c.setLineDash([0,a/4,a/4]),c.beginPath(),c.moveTo(e*a,t*a),c.lineTo(e*a+a,t*a),c.stroke()),i.south&&(c.fillStyle="#ffffff",c.fillRect(e*a+F/2,(t+1)*a-F,a-F,F*2),c.lineWidth=x,c.setLineDash([0,a/4,a/4]),c.beginPath(),c.moveTo(e*a,(t+1)*a),c.lineTo(e*a+a,(t+1)*a),c.stroke()),i.east&&(c.fillStyle="#ffffff",c.fillRect(e*a+a-F,t*a+F/2,F*2,a-F),c.lineWidth=x,c.setLineDash([0,a/4,a/4]),c.beginPath(),c.moveTo(e*a+a,t*a),c.lineTo(e*a+a,t*a+a),c.stroke()),i.west&&(c.fillStyle="#ffffff",c.fillRect(e*a-F,t*a+F/2,F*2,a-F),c.lineWidth=x,c.setLineDash([0,a/4,a/4]),c.beginPath(),c.moveTo(e*a,t*a),c.lineTo(e*a,t*a+a),c.stroke())}let Tt={north:[[0,0],[a,0]],east:[[a,0],[a,a]],south:[[0,a],[a,a]],west:[[0,0],[0,a]]};function Ct(e){return[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2]}function G(e,t,i,r,n){n=n??F;let s=Tt[i],l=Ct(s);switch(c.strokeStyle="#000000",c.lineWidth=n,c.beginPath(),c.moveTo(e*a+s[0][0],t*a+s[0][1]),c.lineTo(e*a+s[1][0],t*a+s[1][1]),c.stroke(),r){default:case"open":c.fillStyle="#ffffff",c.fillRect(e*a+l[0]-a/(2*3),t*a+l[1]-a/(2*3),a/3,a/3);break;case"closed":c.fillStyle="#ffffff",c.fillRect(e*a+l[0]-a/(2*3),t*a+l[1]-a/(2*3),a/3,a/3),c.beginPath(),c.rect(e*a+l[0]-a/(2*3),t*a+l[1]-a/(2*3),a/3,a/3),c.stroke();break;case"locked":c.beginPath(),c.rect(e*a+l[0]-a/(2*3),t*a+l[1]-a/(2*3),a/3,a/3),c.stroke();break;case"secret":c.fillStyle="#000000",c.strokeStyle="#ffffff",c.font="16px sans-serif",c.textAlign="center",c.textBaseline="middle",c.strokeText("S",e*a+l[0],t*a+l[1]),c.fillText("S",e*a+l[0],t*a+l[1]);break;case"trapped":c.fillStyle="#ffffff",c.fillRect(e*a+l[0]-a/(2*3),t*a+l[1]-a/(2*3),a/3,a/3),c.beginPath(),c.rect(e*a+l[0]-a/(2*3),t*a+l[1]-a/(2*3),a/3,a/3),c.stroke(),c.fillStyle="#000000",c.strokeStyle="#ffffff",c.font="17px sans-serif",c.textAlign="center",c.textBaseline="middle",c.fillText("-",e*a+l[0],t*a+l[1]);break}}function Bt(e,t){return e.x<t.x+t.width&&t.x<e.x+e.width&&e.y<t.y+t.height?t.y<e.y+e.height:!1}let Se={north:[Math.ceil(T/2),0],east:[T-1,Math.ceil(C/2)],south:[Math.ceil(T/2),C-1],west:[0,Math.ceil(C/2)]},D=[];function P(e,t,i){return D.find(r=>r.type===i&&e>=r.x&&t>=r.y&&e<r.x+r.width&&t<r.y+r.height)}Object.keys(Se).forEach(e=>{let t=Se[e];D.push({x:t[0],y:t[1],width:1,height:1,type:"exit",orientation:e})});function $t(){for(let e=0;e<5;e++){let t=3+Math.floor(Math.random()*3),i=3+Math.floor(Math.random()*3),r=1+Math.floor((T-t-2)*Math.random()),n=1+Math.floor((C-i-2)*Math.random()),o={x:r,y:n,width:t,height:i,type:"room"};D.some(s=>Bt({x:r-1,y:n-1,width:t+2,height:i+2,type:"room"},s))||D.push(o)}}for(let e=0;e<10;e++)$t();let Je=new jsgraphs.WeightedGraph(D.length*D.length);D.forEach((e,t)=>{D.forEach((i,r)=>{if(t===r)return;let n=Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2));Je.addEdge(new jsgraphs.Edge(t,r,n))})});let Rt=new jsgraphs.LazyPrimMST(Je),De=Rt.mst;for(let e=0;e<De.length;++e){let t=De[e],i=t.either(),r=t.other(i);console.log("("+i+", "+r+"): "+t.weight);let n=D[i],o=D[r],s=new K.Grid(T,C),l=new K.AStarFinder().findPath(Math.floor(n.x+n.width/2),Math.floor(n.y+n.height/2),Math.floor(o.x+o.width/2),Math.floor(o.y+o.height/2),s);console.log(l),l.forEach((d,u)=>{P(d[0],d[1],"room")&&(D[D.length-1].needDoor=!0),D.push({x:d[0],y:d[1],width:1,height:1,type:"corridor",needDoor:u>0&&!!P(l[u-1][0],l[[u-1]][1],"room")})})}let j=new Array(T).fill(null).map(()=>new Array(C).fill(!1));D.forEach(e=>{for(let t=0;t<e.width;t++)for(let i=0;i<e.height;i++)j[t+e.x][i+e.y]=!0});D=D.filter(e=>e.type==="corridor"?!(P(e.x,e.y,"room")||P(e.x,e.y,"exit")):!0);function xe(e){switch(e.type){case"exit":pe(e.x,e.y,e.width,e.height),G(e.x,e.y,e.orientation,"door"),c.fillStyle="#000000",c.strokeStyle="#ffffff",c.font="20px sans-serif",c.textAlign="center",c.textBaseline="middle";let t={north:"↑",east:"→",south:"↓",west:"←"};c.strokeText(t[e.orientation],e.x*a+a/2,e.y*a+a/2),c.fillText(t[e.orientation],e.x*a+a/2,e.y*a+a/2);break;case"corridor":It(e.x,e.y,{north:!!P(e.x,e.y-1,"corridor")||!!P(e.x,e.y-1,"exit"),east:!!P(e.x+1,e.y,"corridor")||!!P(e.x+1,e.y,"exit"),south:!!P(e.x,e.y+1,"corridor")||!!P(e.x,e.y+1,"exit"),west:!!P(e.x-1,e.y,"corridor")||!!P(e.x-1,e.y,"exit")});break;case"room":pe(e.x,e.y,e.width,e.height);break}}Ot(0,0,T*a,C*a,ce,3,e=>{let t=Math.floor(e[0]/a),i=Math.floor(e[1]/a);return t<0||t>=T||i<0||i>=C?!1:!!(j[t][i]||t+1<T&&j[t+1][i]||t-1>=0&&j[t-1][i]||i+1<C&&j[t][i+1]||i-1>=0&&j[t][i-1])});D.filter(e=>e.type==="corridor"||e.type==="exit").forEach(xe);D.filter(e=>e.type!=="corridor"&&e.type!=="exit").forEach(xe);D.filter(e=>e.type==="corridor"&&e.needDoor===!0).forEach(e=>{let t=["open","closed"];P(e.x+1,e.y,"room")&&G(e.x,e.y,"east",t[Math.floor(Math.random()*t.length)]),P(e.x-1,e.y,"room")&&G(e.x,e.y,"west",t[Math.floor(Math.random()*t.length)]),P(e.x,e.y+1,"room")&&G(e.x,e.y,"south",t[Math.floor(Math.random()*t.length)]),P(e.x,e.y-1,"room")&&G(e.x,e.y,"north",t[Math.floor(Math.random()*t.length)])});

</script>
<script>
    if (random) {
        Math.random = random;
    }
</script>
<script src="https://cdn.jsdelivr.net/gh/kchapelier/poisson-disk-sampling@2.3.1/build/poisson-disk-sampling.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/chen0040/js-graph-algorithms/build/jsgraphs.min.js"></script>

<div id="app" style="width: 567px; border: 1px solid gray; display: flex; justify-content: center; align-items: center;">
    <canvas width="567" height="946"></canvas>
</div>

