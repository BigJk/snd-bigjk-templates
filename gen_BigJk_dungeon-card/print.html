<script type="module" crossorigin>
var ie=(i,s)=>()=>(s||i((s={exports:{}}).exports,s),s.exports);var ce=ie((q,_)=>{(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))d(h);new MutationObserver(h=>{for(const p of h)if(p.type==="childList")for(const e of p.addedNodes)e.tagName==="LINK"&&e.rel==="modulepreload"&&d(e)}).observe(document,{childList:!0,subtree:!0});function N(h){const p={};return h.integrity&&(p.integrity=h.integrity),h.referrerpolicy&&(p.referrerPolicy=h.referrerpolicy),h.crossorigin==="use-credentials"?p.credentials="include":h.crossorigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function d(h){if(h.ep)return;h.ep=!0;const p=N(h);fetch(h.href,p)}})();(function(i){if(typeof q=="object")_.exports=i();else if(typeof define=="function"&&define.amd)define(i);else{var s;typeof window<"u"?s=window:typeof global<"u"?s=global:typeof self<"u"&&(s=self),s.PF=i()}})(function(){return function i(s,N,d){function h(t,o){if(!N[t]){if(!s[t]){var r=typeof require=="function"&&require;if(!o&&r)return r(t,!0);if(p)return p(t,!0);throw new Error("Cannot find module '"+t+"'")}var n=N[t]={exports:{}};s[t][0].call(n.exports,function(a){var g=s[t][1][a];return h(g||a)},n,n.exports,i,s,N,d)}return N[t].exports}for(var p=typeof require=="function"&&require,e=0;e<d.length;e++)h(d[e]);return h}({1:[function(i,s,N){s.exports=i("./lib/heap")},{"./lib/heap":2}],2:[function(i,s,N){(function(){var d,h,p,e,t,o,r,n,a,g,b,v,u,w,y;p=Math.floor,g=Math.min,h=function(l,c){return l<c?-1:l>c?1:0},a=function(l,c,A,M,S){var k;if(A==null&&(A=0),S==null&&(S=h),A<0)throw new Error("lo must be non-negative");for(M==null&&(M=l.length);A<M;)k=p((A+M)/2),S(c,l[k])<0?M=k:A=k+1;return[].splice.apply(l,[A,A-A].concat(c)),c},o=function(l,c,A){return A==null&&(A=h),l.push(c),w(l,0,l.length-1,A)},t=function(l,c){var A,M;return c==null&&(c=h),A=l.pop(),l.length?(M=l[0],l[0]=A,y(l,0,c)):M=A,M},n=function(l,c,A){var M;return A==null&&(A=h),M=l[0],l[0]=c,y(l,0,A),M},r=function(l,c,A){var M;return A==null&&(A=h),l.length&&A(l[0],c)<0&&(M=[l[0],c],c=M[0],l[0]=M[1],y(l,0,A)),c},e=function(l,c){var A,M,S,k,D,W;for(c==null&&(c=h),k=function(){W=[];for(var F=0,P=p(l.length/2);0<=P?F<P:F>P;0<=P?F++:F--)W.push(F);return W}.apply(this).reverse(),D=[],M=0,S=k.length;M<S;M++)A=k[M],D.push(y(l,A,c));return D},u=function(l,c,A){var M;if(A==null&&(A=h),M=l.indexOf(c),M!==-1)return w(l,0,M,A),y(l,M,A)},b=function(l,c,A){var M,S,k,D,W;if(A==null&&(A=h),S=l.slice(0,c),!S.length)return S;for(e(S,A),W=l.slice(c),k=0,D=W.length;k<D;k++)M=W[k],r(S,M,A);return S.sort(A).reverse()},v=function(l,c,A){var M,S,k,D,W,F,P,O,I;if(A==null&&(A=h),c*10<=l.length){if(k=l.slice(0,c).sort(A),!k.length)return k;for(S=k[k.length-1],P=l.slice(c),D=0,F=P.length;D<F;D++)M=P[D],A(M,S)<0&&(a(k,M,0,null,A),k.pop(),S=k[k.length-1]);return k}for(e(l,A),I=[],W=0,O=g(c,l.length);0<=O?W<O:W>O;0<=O?++W:--W)I.push(t(l,A));return I},w=function(l,c,A,M){var S,k,D;for(M==null&&(M=h),S=l[A];A>c;){if(D=A-1>>1,k=l[D],M(S,k)<0){l[A]=k,A=D;continue}break}return l[A]=S},y=function(l,c,A){var M,S,k,D,W;for(A==null&&(A=h),S=l.length,W=c,k=l[c],M=2*c+1;M<S;)D=M+1,D<S&&!(A(l[M],l[D])<0)&&(M=D),l[c]=l[M],c=M,M=2*c+1;return l[c]=k,w(l,W,c,A)},d=function(){l.push=o,l.pop=t,l.replace=n,l.pushpop=r,l.heapify=e,l.updateItem=u,l.nlargest=b,l.nsmallest=v;function l(c){this.cmp=c??h,this.nodes=[]}return l.prototype.push=function(c){return o(this.nodes,c,this.cmp)},l.prototype.pop=function(){return t(this.nodes,this.cmp)},l.prototype.peek=function(){return this.nodes[0]},l.prototype.contains=function(c){return this.nodes.indexOf(c)!==-1},l.prototype.replace=function(c){return n(this.nodes,c,this.cmp)},l.prototype.pushpop=function(c){return r(this.nodes,c,this.cmp)},l.prototype.heapify=function(){return e(this.nodes,this.cmp)},l.prototype.updateItem=function(c){return u(this.nodes,c,this.cmp)},l.prototype.clear=function(){return this.nodes=[]},l.prototype.empty=function(){return this.nodes.length===0},l.prototype.size=function(){return this.nodes.length},l.prototype.clone=function(){var c;return c=new l,c.nodes=this.nodes.slice(0),c},l.prototype.toArray=function(){return this.nodes.slice(0)},l.prototype.insert=l.prototype.push,l.prototype.top=l.prototype.peek,l.prototype.front=l.prototype.peek,l.prototype.has=l.prototype.contains,l.prototype.copy=l.prototype.clone,l}(),typeof s<"u"&&s!==null&&s.exports?s.exports=d:window.Heap=d}).call(this)},{}],3:[function(i,s,N){var d={Always:1,Never:2,IfAtMostOneObstacle:3,OnlyWhenNoObstacles:4};s.exports=d},{}],4:[function(i,s,N){var d=i("./Node"),h=i("./DiagonalMovement");function p(e,t,o){var r;typeof e!="object"?r=e:(t=e.length,r=e[0].length,o=e),this.width=r,this.height=t,this.nodes=this._buildNodes(r,t,o)}p.prototype._buildNodes=function(e,t,o){var r,n,a=new Array(t);for(r=0;r<t;++r)for(a[r]=new Array(e),n=0;n<e;++n)a[r][n]=new d(n,r);if(o===void 0)return a;if(o.length!==t||o[0].length!==e)throw new Error("Matrix size does not fit");for(r=0;r<t;++r)for(n=0;n<e;++n)o[r][n]&&(a[r][n].walkable=!1);return a},p.prototype.getNodeAt=function(e,t){return this.nodes[t][e]},p.prototype.isWalkableAt=function(e,t){return this.isInside(e,t)&&this.nodes[t][e].walkable},p.prototype.isInside=function(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height},p.prototype.setWalkableAt=function(e,t,o){this.nodes[t][e].walkable=o},p.prototype.getNeighbors=function(e,t){var o=e.x,r=e.y,n=[],a=!1,g=!1,b=!1,v=!1,u=!1,w=!1,y=!1,l=!1,c=this.nodes;if(this.isWalkableAt(o,r-1)&&(n.push(c[r-1][o]),a=!0),this.isWalkableAt(o+1,r)&&(n.push(c[r][o+1]),b=!0),this.isWalkableAt(o,r+1)&&(n.push(c[r+1][o]),u=!0),this.isWalkableAt(o-1,r)&&(n.push(c[r][o-1]),y=!0),t===h.Never)return n;if(t===h.OnlyWhenNoObstacles)g=y&&a,v=a&&b,w=b&&u,l=u&&y;else if(t===h.IfAtMostOneObstacle)g=y||a,v=a||b,w=b||u,l=u||y;else if(t===h.Always)g=!0,v=!0,w=!0,l=!0;else throw new Error("Incorrect value of diagonalMovement");return g&&this.isWalkableAt(o-1,r-1)&&n.push(c[r-1][o-1]),v&&this.isWalkableAt(o+1,r-1)&&n.push(c[r-1][o+1]),w&&this.isWalkableAt(o+1,r+1)&&n.push(c[r+1][o+1]),l&&this.isWalkableAt(o-1,r+1)&&n.push(c[r+1][o-1]),n},p.prototype.clone=function(){var e,t,o=this.width,r=this.height,n=this.nodes,a=new p(o,r),g=new Array(r);for(e=0;e<r;++e)for(g[e]=new Array(o),t=0;t<o;++t)g[e][t]=new d(t,e,n[e][t].walkable);return a.nodes=g,a},s.exports=p},{"./DiagonalMovement":3,"./Node":6}],5:[function(i,s,N){s.exports={manhattan:function(d,h){return d+h},euclidean:function(d,h){return Math.sqrt(d*d+h*h)},octile:function(d,h){var p=Math.SQRT2-1;return d<h?p*d+h:p*h+d},chebyshev:function(d,h){return Math.max(d,h)}}},{}],6:[function(i,s,N){function d(h,p,e){this.x=h,this.y=p,this.walkable=e===void 0?!0:e}s.exports=d},{}],7:[function(i,s,N){function d(n){for(var a=[[n.x,n.y]];n.parent;)n=n.parent,a.push([n.x,n.y]);return a.reverse()}N.backtrace=d;function h(n,a){var g=d(n),b=d(a);return g.concat(b.reverse())}N.biBacktrace=h;function p(n){var a,g=0,b,v,u,w;for(a=1;a<n.length;++a)b=n[a-1],v=n[a],u=b[0]-v[0],w=b[1]-v[1],g+=Math.sqrt(u*u+w*w);return g}N.pathLength=p;function e(n,a,g,b){var v=Math.abs,u=[],w,y,l,c,A,M;for(l=v(g-n),c=v(b-a),w=n<g?1:-1,y=a<b?1:-1,A=l-c;u.push([n,a]),!(n===g&&a===b);)M=2*A,M>-c&&(A=A-c,n=n+w),M<l&&(A=A+l,a=a+y);return u}N.interpolate=e;function t(n){var a=[],g=n.length,b,v,u,w,y,l;if(g<2)return a;for(y=0;y<g-1;++y)for(b=n[y],v=n[y+1],u=e(b[0],b[1],v[0],v[1]),w=u.length,l=0;l<w-1;++l)a.push(u[l]);return a.push(n[g-1]),a}N.expandPath=t;function o(n,a){var g=a.length,b=a[0][0],v=a[0][1],u=a[g-1][0],w=a[g-1][1],y,l,c,A,M,S,k,D,W,F,P;for(y=b,l=v,M=[[y,l]],S=2;S<g;++S){for(D=a[S],c=D[0],A=D[1],W=e(y,l,c,A),P=!1,k=1;k<W.length;++k)if(F=W[k],!n.isWalkableAt(F[0],F[1])){P=!0;break}P&&(lastValidCoord=a[S-1],M.push(lastValidCoord),y=lastValidCoord[0],l=lastValidCoord[1])}return M.push([u,w]),M}N.smoothenPath=o;function r(n){if(n.length<3)return n;var a=[],g=n[0][0],b=n[0][1],v=n[1][0],u=n[1][1],w=v-g,y=u-b,l,c,A,M,S,k;for(S=Math.sqrt(w*w+y*y),w/=S,y/=S,a.push([g,b]),k=2;k<n.length;k++)l=v,c=u,A=w,M=y,v=n[k][0],u=n[k][1],w=v-l,y=u-c,S=Math.sqrt(w*w+y*y),w/=S,y/=S,(w!==A||y!==M)&&a.push([l,c]);return a.push([v,u]),a}N.compressPath=r},{}],8:[function(i,s,N){s.exports={Heap:i("heap"),Node:i("./core/Node"),Grid:i("./core/Grid"),Util:i("./core/Util"),DiagonalMovement:i("./core/DiagonalMovement"),Heuristic:i("./core/Heuristic"),AStarFinder:i("./finders/AStarFinder"),BestFirstFinder:i("./finders/BestFirstFinder"),BreadthFirstFinder:i("./finders/BreadthFirstFinder"),DijkstraFinder:i("./finders/DijkstraFinder"),BiAStarFinder:i("./finders/BiAStarFinder"),BiBestFirstFinder:i("./finders/BiBestFirstFinder"),BiBreadthFirstFinder:i("./finders/BiBreadthFirstFinder"),BiDijkstraFinder:i("./finders/BiDijkstraFinder"),IDAStarFinder:i("./finders/IDAStarFinder"),JumpPointFinder:i("./finders/JumpPointFinder")}},{"./core/DiagonalMovement":3,"./core/Grid":4,"./core/Heuristic":5,"./core/Node":6,"./core/Util":7,"./finders/AStarFinder":9,"./finders/BestFirstFinder":10,"./finders/BiAStarFinder":11,"./finders/BiBestFirstFinder":12,"./finders/BiBreadthFirstFinder":13,"./finders/BiDijkstraFinder":14,"./finders/BreadthFirstFinder":15,"./finders/DijkstraFinder":16,"./finders/IDAStarFinder":17,"./finders/JumpPointFinder":22,heap:1}],9:[function(i,s,N){var d=i("heap"),h=i("../core/Util"),p=i("../core/Heuristic"),e=i("../core/DiagonalMovement");function t(o){o=o||{},this.allowDiagonal=o.allowDiagonal,this.dontCrossCorners=o.dontCrossCorners,this.heuristic=o.heuristic||p.manhattan,this.weight=o.weight||1,this.diagonalMovement=o.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=e.OnlyWhenNoObstacles:this.diagonalMovement=e.IfAtMostOneObstacle:this.diagonalMovement=e.Never),this.diagonalMovement===e.Never?this.heuristic=o.heuristic||p.manhattan:this.heuristic=o.heuristic||p.octile}t.prototype.findPath=function(o,r,n,a,g){var b=new d(function(I,H){return I.f-H.f}),v=g.getNodeAt(o,r),u=g.getNodeAt(n,a),w=this.heuristic,y=this.diagonalMovement,l=this.weight,c=Math.abs,A=Math.SQRT2,M,S,k,D,W,F,P,O;for(v.g=0,v.f=0,b.push(v),v.opened=!0;!b.empty();){if(M=b.pop(),M.closed=!0,M===u)return h.backtrace(u);for(S=g.getNeighbors(M,y),D=0,W=S.length;D<W;++D)k=S[D],!k.closed&&(F=k.x,P=k.y,O=M.g+(F-M.x===0||P-M.y===0?1:A),(!k.opened||O<k.g)&&(k.g=O,k.h=k.h||l*w(c(F-n),c(P-a)),k.f=k.g+k.h,k.parent=M,k.opened?b.updateItem(k):(b.push(k),k.opened=!0)))}return[]},s.exports=t},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Util":7,heap:1}],10:[function(i,s,N){var d=i("./AStarFinder");function h(p){d.call(this,p);var e=this.heuristic;this.heuristic=function(t,o){return e(t,o)*1e6}}h.prototype=new d,h.prototype.constructor=h,s.exports=h},{"./AStarFinder":9}],11:[function(i,s,N){var d=i("heap"),h=i("../core/Util"),p=i("../core/Heuristic"),e=i("../core/DiagonalMovement");function t(o){o=o||{},this.allowDiagonal=o.allowDiagonal,this.dontCrossCorners=o.dontCrossCorners,this.diagonalMovement=o.diagonalMovement,this.heuristic=o.heuristic||p.manhattan,this.weight=o.weight||1,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=e.OnlyWhenNoObstacles:this.diagonalMovement=e.IfAtMostOneObstacle:this.diagonalMovement=e.Never),this.diagonalMovement===e.Never?this.heuristic=o.heuristic||p.manhattan:this.heuristic=o.heuristic||p.octile}t.prototype.findPath=function(o,r,n,a,g){var b=function(ee,te){return ee.f-te.f},v=new d(b),u=new d(b),w=g.getNodeAt(o,r),y=g.getNodeAt(n,a),l=this.heuristic,c=this.diagonalMovement,A=this.weight,M=Math.abs,S=Math.SQRT2,k,D,W,F,P,O,I,H,x=1,z=2;for(w.g=0,w.f=0,v.push(w),w.opened=x,y.g=0,y.f=0,u.push(y),y.opened=z;!v.empty()&&!u.empty();){for(k=v.pop(),k.closed=!0,D=g.getNeighbors(k,c),F=0,P=D.length;F<P;++F)if(W=D[F],!W.closed){if(W.opened===z)return h.biBacktrace(k,W);O=W.x,I=W.y,H=k.g+(O-k.x===0||I-k.y===0?1:S),(!W.opened||H<W.g)&&(W.g=H,W.h=W.h||A*l(M(O-n),M(I-a)),W.f=W.g+W.h,W.parent=k,W.opened?v.updateItem(W):(v.push(W),W.opened=x))}for(k=u.pop(),k.closed=!0,D=g.getNeighbors(k,c),F=0,P=D.length;F<P;++F)if(W=D[F],!W.closed){if(W.opened===x)return h.biBacktrace(W,k);O=W.x,I=W.y,H=k.g+(O-k.x===0||I-k.y===0?1:S),(!W.opened||H<W.g)&&(W.g=H,W.h=W.h||A*l(M(O-o),M(I-r)),W.f=W.g+W.h,W.parent=k,W.opened?u.updateItem(W):(u.push(W),W.opened=z))}}return[]},s.exports=t},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Util":7,heap:1}],12:[function(i,s,N){var d=i("./BiAStarFinder");function h(p){d.call(this,p);var e=this.heuristic;this.heuristic=function(t,o){return e(t,o)*1e6}}h.prototype=new d,h.prototype.constructor=h,s.exports=h},{"./BiAStarFinder":11}],13:[function(i,s,N){var d=i("../core/Util"),h=i("../core/DiagonalMovement");function p(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=h.OnlyWhenNoObstacles:this.diagonalMovement=h.IfAtMostOneObstacle:this.diagonalMovement=h.Never)}p.prototype.findPath=function(e,t,o,r,n){var a=n.getNodeAt(e,t),g=n.getNodeAt(o,r),b=[],v=[],u,w,y,l=this.diagonalMovement,c=0,A=1,M,S;for(b.push(a),a.opened=!0,a.by=c,v.push(g),g.opened=!0,g.by=A;b.length&&v.length;){for(y=b.shift(),y.closed=!0,u=n.getNeighbors(y,l),M=0,S=u.length;M<S;++M)if(w=u[M],!w.closed){if(w.opened){if(w.by===A)return d.biBacktrace(y,w);continue}b.push(w),w.parent=y,w.opened=!0,w.by=c}for(y=v.shift(),y.closed=!0,u=n.getNeighbors(y,l),M=0,S=u.length;M<S;++M)if(w=u[M],!w.closed){if(w.opened){if(w.by===c)return d.biBacktrace(w,y);continue}v.push(w),w.parent=y,w.opened=!0,w.by=A}}return[]},s.exports=p},{"../core/DiagonalMovement":3,"../core/Util":7}],14:[function(i,s,N){var d=i("./BiAStarFinder");function h(p){d.call(this,p),this.heuristic=function(e,t){return 0}}h.prototype=new d,h.prototype.constructor=h,s.exports=h},{"./BiAStarFinder":11}],15:[function(i,s,N){var d=i("../core/Util"),h=i("../core/DiagonalMovement");function p(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=h.OnlyWhenNoObstacles:this.diagonalMovement=h.IfAtMostOneObstacle:this.diagonalMovement=h.Never)}p.prototype.findPath=function(e,t,o,r,n){var a=[],g=this.diagonalMovement,b=n.getNodeAt(e,t),v=n.getNodeAt(o,r),u,w,y,l,c;for(a.push(b),b.opened=!0;a.length;){if(y=a.shift(),y.closed=!0,y===v)return d.backtrace(v);for(u=n.getNeighbors(y,g),l=0,c=u.length;l<c;++l)w=u[l],!(w.closed||w.opened)&&(a.push(w),w.opened=!0,w.parent=y)}return[]},s.exports=p},{"../core/DiagonalMovement":3,"../core/Util":7}],16:[function(i,s,N){var d=i("./AStarFinder");function h(p){d.call(this,p),this.heuristic=function(e,t){return 0}}h.prototype=new d,h.prototype.constructor=h,s.exports=h},{"./AStarFinder":9}],17:[function(i,s,N){i("../core/Util");var d=i("../core/Heuristic"),h=i("../core/Node"),p=i("../core/DiagonalMovement");function e(t){t=t||{},this.allowDiagonal=t.allowDiagonal,this.dontCrossCorners=t.dontCrossCorners,this.diagonalMovement=t.diagonalMovement,this.heuristic=t.heuristic||d.manhattan,this.weight=t.weight||1,this.trackRecursion=t.trackRecursion||!1,this.timeLimit=t.timeLimit||1/0,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=p.OnlyWhenNoObstacles:this.diagonalMovement=p.IfAtMostOneObstacle:this.diagonalMovement=p.Never),this.diagonalMovement===p.Never?this.heuristic=t.heuristic||d.manhattan:this.heuristic=t.heuristic||d.octile}e.prototype.findPath=function(t,o,r,n,a){var g=new Date().getTime(),b=function(S,k){return this.heuristic(Math.abs(k.x-S.x),Math.abs(k.y-S.y))}.bind(this),v=function(S,k){return S.x===k.x||S.y===k.y?1:Math.SQRT2},u=function(S,k,D,W,F){if(this.timeLimit>0&&new Date().getTime()-g>this.timeLimit*1e3)return 1/0;var P=k+b(S,y)*this.weight;if(P>D)return P;if(S==y)return W[F]=[S.x,S.y],S;var O,I,H,x,z=a.getNeighbors(S,this.diagonalMovement);for(H=0,O=1/0;x=z[H];++H){if(this.trackRecursion&&(x.retainCount=x.retainCount+1||1,x.tested!==!0&&(x.tested=!0)),I=u(x,k+v(S,x),D,W,F+1),I instanceof h)return W[F]=[S.x,S.y],I;this.trackRecursion&&--x.retainCount===0&&(x.tested=!1),I<O&&(O=I)}return O}.bind(this),w=a.getNodeAt(t,o),y=a.getNodeAt(r,n),l=b(w,y),c,A,M;for(c=0;;++c){if(A=[],M=u(w,0,l,A,0),M===1/0)return[];if(M instanceof h)return A;l=M}return[]},s.exports=e},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Node":6,"../core/Util":7}],18:[function(i,s,N){var d=i("./JumpPointFinderBase"),h=i("../core/DiagonalMovement");function p(e){d.call(this,e)}p.prototype=new d,p.prototype.constructor=p,p.prototype._jump=function(e,t,o,r){var n=this.grid,a=e-o,g=t-r;if(!n.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(n.getNodeAt(e,t).tested=!0),n.getNodeAt(e,t)===this.endNode)return[e,t];if(a!==0&&g!==0){if(n.isWalkableAt(e-a,t+g)&&!n.isWalkableAt(e-a,t)||n.isWalkableAt(e+a,t-g)&&!n.isWalkableAt(e,t-g))return[e,t];if(this._jump(e+a,t,e,t)||this._jump(e,t+g,e,t))return[e,t]}else if(a!==0){if(n.isWalkableAt(e+a,t+1)&&!n.isWalkableAt(e,t+1)||n.isWalkableAt(e+a,t-1)&&!n.isWalkableAt(e,t-1))return[e,t]}else if(n.isWalkableAt(e+1,t+g)&&!n.isWalkableAt(e+1,t)||n.isWalkableAt(e-1,t+g)&&!n.isWalkableAt(e-1,t))return[e,t];return this._jump(e+a,t+g,e,t)},p.prototype._findNeighbors=function(e){var t=e.parent,o=e.x,r=e.y,n=this.grid,a,g,b,v,u=[],w,y,l,c;if(t)a=t.x,g=t.y,b=(o-a)/Math.max(Math.abs(o-a),1),v=(r-g)/Math.max(Math.abs(r-g),1),b!==0&&v!==0?(n.isWalkableAt(o,r+v)&&u.push([o,r+v]),n.isWalkableAt(o+b,r)&&u.push([o+b,r]),n.isWalkableAt(o+b,r+v)&&u.push([o+b,r+v]),n.isWalkableAt(o-b,r)||u.push([o-b,r+v]),n.isWalkableAt(o,r-v)||u.push([o+b,r-v])):b===0?(n.isWalkableAt(o,r+v)&&u.push([o,r+v]),n.isWalkableAt(o+1,r)||u.push([o+1,r+v]),n.isWalkableAt(o-1,r)||u.push([o-1,r+v])):(n.isWalkableAt(o+b,r)&&u.push([o+b,r]),n.isWalkableAt(o,r+1)||u.push([o+b,r+1]),n.isWalkableAt(o,r-1)||u.push([o+b,r-1]));else for(w=n.getNeighbors(e,h.Always),l=0,c=w.length;l<c;++l)y=w[l],u.push([y.x,y.y]);return u},s.exports=p},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],19:[function(i,s,N){var d=i("./JumpPointFinderBase"),h=i("../core/DiagonalMovement");function p(e){d.call(this,e)}p.prototype=new d,p.prototype.constructor=p,p.prototype._jump=function(e,t,o,r){var n=this.grid,a=e-o,g=t-r;if(!n.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(n.getNodeAt(e,t).tested=!0),n.getNodeAt(e,t)===this.endNode)return[e,t];if(a!==0&&g!==0){if(n.isWalkableAt(e-a,t+g)&&!n.isWalkableAt(e-a,t)||n.isWalkableAt(e+a,t-g)&&!n.isWalkableAt(e,t-g))return[e,t];if(this._jump(e+a,t,e,t)||this._jump(e,t+g,e,t))return[e,t]}else if(a!==0){if(n.isWalkableAt(e+a,t+1)&&!n.isWalkableAt(e,t+1)||n.isWalkableAt(e+a,t-1)&&!n.isWalkableAt(e,t-1))return[e,t]}else if(n.isWalkableAt(e+1,t+g)&&!n.isWalkableAt(e+1,t)||n.isWalkableAt(e-1,t+g)&&!n.isWalkableAt(e-1,t))return[e,t];return n.isWalkableAt(e+a,t)||n.isWalkableAt(e,t+g)?this._jump(e+a,t+g,e,t):null},p.prototype._findNeighbors=function(e){var t=e.parent,o=e.x,r=e.y,n=this.grid,a,g,b,v,u=[],w,y,l,c;if(t)a=t.x,g=t.y,b=(o-a)/Math.max(Math.abs(o-a),1),v=(r-g)/Math.max(Math.abs(r-g),1),b!==0&&v!==0?(n.isWalkableAt(o,r+v)&&u.push([o,r+v]),n.isWalkableAt(o+b,r)&&u.push([o+b,r]),(n.isWalkableAt(o,r+v)||n.isWalkableAt(o+b,r))&&u.push([o+b,r+v]),!n.isWalkableAt(o-b,r)&&n.isWalkableAt(o,r+v)&&u.push([o-b,r+v]),!n.isWalkableAt(o,r-v)&&n.isWalkableAt(o+b,r)&&u.push([o+b,r-v])):b===0?n.isWalkableAt(o,r+v)&&(u.push([o,r+v]),n.isWalkableAt(o+1,r)||u.push([o+1,r+v]),n.isWalkableAt(o-1,r)||u.push([o-1,r+v])):n.isWalkableAt(o+b,r)&&(u.push([o+b,r]),n.isWalkableAt(o,r+1)||u.push([o+b,r+1]),n.isWalkableAt(o,r-1)||u.push([o+b,r-1]));else for(w=n.getNeighbors(e,h.IfAtMostOneObstacle),l=0,c=w.length;l<c;++l)y=w[l],u.push([y.x,y.y]);return u},s.exports=p},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],20:[function(i,s,N){var d=i("./JumpPointFinderBase"),h=i("../core/DiagonalMovement");function p(e){d.call(this,e)}p.prototype=new d,p.prototype.constructor=p,p.prototype._jump=function(e,t,o,r){var n=this.grid,a=e-o,g=t-r;if(!n.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(n.getNodeAt(e,t).tested=!0),n.getNodeAt(e,t)===this.endNode)return[e,t];if(a!==0&&g!==0){if(this._jump(e+a,t,e,t)||this._jump(e,t+g,e,t))return[e,t]}else if(a!==0){if(n.isWalkableAt(e,t-1)&&!n.isWalkableAt(e-a,t-1)||n.isWalkableAt(e,t+1)&&!n.isWalkableAt(e-a,t+1))return[e,t]}else if(g!==0&&(n.isWalkableAt(e-1,t)&&!n.isWalkableAt(e-1,t-g)||n.isWalkableAt(e+1,t)&&!n.isWalkableAt(e+1,t-g)))return[e,t];return n.isWalkableAt(e+a,t)&&n.isWalkableAt(e,t+g)?this._jump(e+a,t+g,e,t):null},p.prototype._findNeighbors=function(e){var t=e.parent,o=e.x,r=e.y,n=this.grid,a,g,b,v,u=[],w,y,l,c;if(t)if(a=t.x,g=t.y,b=(o-a)/Math.max(Math.abs(o-a),1),v=(r-g)/Math.max(Math.abs(r-g),1),b!==0&&v!==0)n.isWalkableAt(o,r+v)&&u.push([o,r+v]),n.isWalkableAt(o+b,r)&&u.push([o+b,r]),n.isWalkableAt(o,r+v)&&n.isWalkableAt(o+b,r)&&u.push([o+b,r+v]);else{var A;if(b!==0){A=n.isWalkableAt(o+b,r);var M=n.isWalkableAt(o,r+1),S=n.isWalkableAt(o,r-1);A&&(u.push([o+b,r]),M&&u.push([o+b,r+1]),S&&u.push([o+b,r-1])),M&&u.push([o,r+1]),S&&u.push([o,r-1])}else if(v!==0){A=n.isWalkableAt(o,r+v);var k=n.isWalkableAt(o+1,r),D=n.isWalkableAt(o-1,r);A&&(u.push([o,r+v]),k&&u.push([o+1,r+v]),D&&u.push([o-1,r+v])),k&&u.push([o+1,r]),D&&u.push([o-1,r])}}else for(w=n.getNeighbors(e,h.OnlyWhenNoObstacles),l=0,c=w.length;l<c;++l)y=w[l],u.push([y.x,y.y]);return u},s.exports=p},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],21:[function(i,s,N){var d=i("./JumpPointFinderBase"),h=i("../core/DiagonalMovement");function p(e){d.call(this,e)}p.prototype=new d,p.prototype.constructor=p,p.prototype._jump=function(e,t,o,r){var n=this.grid,a=e-o,g=t-r;if(!n.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(n.getNodeAt(e,t).tested=!0),n.getNodeAt(e,t)===this.endNode)return[e,t];if(a!==0){if(n.isWalkableAt(e,t-1)&&!n.isWalkableAt(e-a,t-1)||n.isWalkableAt(e,t+1)&&!n.isWalkableAt(e-a,t+1))return[e,t]}else if(g!==0){if(n.isWalkableAt(e-1,t)&&!n.isWalkableAt(e-1,t-g)||n.isWalkableAt(e+1,t)&&!n.isWalkableAt(e+1,t-g))return[e,t];if(this._jump(e+1,t,e,t)||this._jump(e-1,t,e,t))return[e,t]}else throw new Error("Only horizontal and vertical movements are allowed");return this._jump(e+a,t+g,e,t)},p.prototype._findNeighbors=function(e){var t=e.parent,o=e.x,r=e.y,n=this.grid,a,g,b,v,u=[],w,y,l,c;if(t)a=t.x,g=t.y,b=(o-a)/Math.max(Math.abs(o-a),1),v=(r-g)/Math.max(Math.abs(r-g),1),b!==0?(n.isWalkableAt(o,r-1)&&u.push([o,r-1]),n.isWalkableAt(o,r+1)&&u.push([o,r+1]),n.isWalkableAt(o+b,r)&&u.push([o+b,r])):v!==0&&(n.isWalkableAt(o-1,r)&&u.push([o-1,r]),n.isWalkableAt(o+1,r)&&u.push([o+1,r]),n.isWalkableAt(o,r+v)&&u.push([o,r+v]));else for(w=n.getNeighbors(e,h.Never),l=0,c=w.length;l<c;++l)y=w[l],u.push([y.x,y.y]);return u},s.exports=p},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],22:[function(i,s,N){var d=i("../core/DiagonalMovement"),h=i("./JPFNeverMoveDiagonally"),p=i("./JPFAlwaysMoveDiagonally"),e=i("./JPFMoveDiagonallyIfNoObstacles"),t=i("./JPFMoveDiagonallyIfAtMostOneObstacle");function o(r){return r=r||{},r.diagonalMovement===d.Never?new h(r):r.diagonalMovement===d.Always?new p(r):r.diagonalMovement===d.OnlyWhenNoObstacles?new e(r):new t(r)}s.exports=o},{"../core/DiagonalMovement":3,"./JPFAlwaysMoveDiagonally":18,"./JPFMoveDiagonallyIfAtMostOneObstacle":19,"./JPFMoveDiagonallyIfNoObstacles":20,"./JPFNeverMoveDiagonally":21}],23:[function(i,s,N){var d=i("heap"),h=i("../core/Util"),p=i("../core/Heuristic");i("../core/DiagonalMovement");function e(t){t=t||{},this.heuristic=t.heuristic||p.manhattan,this.trackJumpRecursion=t.trackJumpRecursion||!1}e.prototype.findPath=function(t,o,r,n,a){var g=this.openList=new d(function(w,y){return w.f-y.f}),b=this.startNode=a.getNodeAt(t,o),v=this.endNode=a.getNodeAt(r,n),u;for(this.grid=a,b.g=0,b.f=0,g.push(b),b.opened=!0;!g.empty();){if(u=g.pop(),u.closed=!0,u===v)return h.expandPath(h.backtrace(v));this._identifySuccessors(u)}return[]},e.prototype._identifySuccessors=function(t){var o=this.grid,r=this.heuristic,n=this.openList,a=this.endNode.x,g=this.endNode.y,b,v,u,w,y,l=t.x,c=t.y,A,M,S,k,D,W=Math.abs;for(b=this._findNeighbors(t),w=0,y=b.length;w<y;++w)if(v=b[w],u=this._jump(v[0],v[1],l,c),u){if(A=u[0],M=u[1],D=o.getNodeAt(A,M),D.closed)continue;S=p.octile(W(A-l),W(M-c)),k=t.g+S,(!D.opened||k<D.g)&&(D.g=k,D.h=D.h||r(W(A-a),W(M-g)),D.f=D.g+D.h,D.parent=t,D.opened?n.updateItem(D):(n.push(D),D.opened=!0))}},s.exports=e},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Util":7,heap:1}]},{},[8])(8)});let R=document.querySelector(window.dungeonGenTarget??"#app canvas"),m=R.getContext("2d"),G=R.width,Y=R.height;window.devicePixelRatio>1&&(R.width=G*window.devicePixelRatio,R.height=Y*window.devicePixelRatio,R.style.width=G+"px",R.style.height=Y+"px",m.scale(window.devicePixelRatio,window.devicePixelRatio));const J=15,j=19;console.log(J,j);const f=G/J,T=2.5,E=1.5,Q=1,ne=1.5;console.log(f);function oe(i,s,N,d,h){let t=(r,n,a)=>(r-=15*d/2,n-=15*d/2,[r*Math.cos(a)-n*Math.sin(a)+15*d/2,r*Math.sin(a)+n*Math.cos(a)+15*d/2]),o=new Array(h).fill(null).map((r,n)=>[t(0,6*d*n,N),t(15*d,6*d*n,N)]);m.strokeStyle="#000000",m.lineWidth=ne*d,o.forEach(r=>{m.beginPath(),m.moveTo(r[0][0]+i,r[0][1]+s),m.lineTo(r[1][0]+i,r[1][1]+s),m.stroke()})}function re(i,s,N,d,h,p,e){new PoissonDiskSampling({shape:[N,d],minDistance:13*Q,maxDistance:18*Q,tries:10}).fill().forEach(o=>{e&&!e(o)||oe(i+o[0],s+o[1],Math.PI*2*Math.random(),h,p)})}function V(i,s,N,d,h,p){h=h??T,p=p??E,m.fillStyle="#ffffff",m.fillRect(i*f,s*f,N*f,d*f),m.lineWidth=p,m.strokeStyle="black",m.setLineDash([0,f/4,f/4]);for(let e=1;e<N;e++)m.beginPath(),m.moveTo(i*f+e*f,s*f),m.lineTo(i*f+e*f,s*f+d*f),m.stroke();for(let e=1;e<d;e++)m.beginPath(),m.moveTo(i*f,s*f+e*f),m.lineTo(i*f+N*f,s*f+e*f),m.stroke();m.setLineDash([]),m.strokeStyle="#000000",m.lineWidth=h,m.beginPath(),m.rect(i*f,s*f,N*f,d*f),m.stroke()}function se(i,s,N){V(i,s,1,1),N.north&&(m.fillStyle="#ffffff",m.fillRect(i*f+T/2,s*f-T,f-T,T*2),m.lineWidth=E,m.setLineDash([0,f/4,f/4]),m.beginPath(),m.moveTo(i*f,s*f),m.lineTo(i*f+f,s*f),m.stroke()),N.south&&(m.fillStyle="#ffffff",m.fillRect(i*f+T/2,(s+1)*f-T,f-T,T*2),m.lineWidth=E,m.setLineDash([0,f/4,f/4]),m.beginPath(),m.moveTo(i*f,(s+1)*f),m.lineTo(i*f+f,(s+1)*f),m.stroke()),N.east&&(m.fillStyle="#ffffff",m.fillRect(i*f+f-T,s*f+T/2,T*2,f-T),m.lineWidth=E,m.setLineDash([0,f/4,f/4]),m.beginPath(),m.moveTo(i*f+f,s*f),m.lineTo(i*f+f,s*f+f),m.stroke()),N.west&&(m.fillStyle="#ffffff",m.fillRect(i*f-T,s*f+T/2,T*2,f-T),m.lineWidth=E,m.setLineDash([0,f/4,f/4]),m.beginPath(),m.moveTo(i*f,s*f),m.lineTo(i*f,s*f+f),m.stroke())}let le={north:[[0,0],[f,0]],east:[[f,0],[f,f]],south:[[0,f],[f,f]],west:[[0,0],[0,f]]};function ae(i){return[(i[0][0]+i[1][0])/2,(i[0][1]+i[1][1])/2]}function U(i,s,N,d,h){h=h??T;let e=le[N],t=ae(e);switch(m.strokeStyle="#000000",m.lineWidth=h,m.beginPath(),m.moveTo(i*f+e[0][0],s*f+e[0][1]),m.lineTo(i*f+e[1][0],s*f+e[1][1]),m.stroke(),d){default:case"open":m.fillStyle="#ffffff",m.fillRect(i*f+t[0]-f/(2*3),s*f+t[1]-f/(2*3),f/3,f/3);break;case"closed":m.fillStyle="#ffffff",m.fillRect(i*f+t[0]-f/(2*3),s*f+t[1]-f/(2*3),f/3,f/3),m.beginPath(),m.rect(i*f+t[0]-f/(2*3),s*f+t[1]-f/(2*3),f/3,f/3),m.stroke();break;case"locked":m.beginPath(),m.rect(i*f+t[0]-f/(2*3),s*f+t[1]-f/(2*3),f/3,f/3),m.stroke();break;case"secret":m.fillStyle="#000000",m.strokeStyle="#ffffff",m.font="16px sans-serif",m.textAlign="center",m.textBaseline="middle",m.strokeText("S",i*f+t[0],s*f+t[1]),m.fillText("S",i*f+t[0],s*f+t[1]);break;case"trapped":m.fillStyle="#ffffff",m.fillRect(i*f+t[0]-f/(2*3),s*f+t[1]-f/(2*3),f/3,f/3),m.beginPath(),m.rect(i*f+t[0]-f/(2*3),s*f+t[1]-f/(2*3),f/3,f/3),m.stroke(),m.fillStyle="#000000",m.strokeStyle="#ffffff",m.font="17px sans-serif",m.textAlign="center",m.textBaseline="middle",m.fillText("-",i*f+t[0],s*f+t[1]);break}}function fe(i,s){return i.x<s.x+s.width&&s.x<i.x+i.width&&i.y<s.y+s.height?s.y<i.y+i.height:!1}let K={north:[Math.ceil(J/2),0],east:[J-1,Math.ceil(j/2)],south:[Math.ceil(J/2),j-1],west:[0,Math.ceil(j/2)]},B=[];function C(i,s,N){return B.find(d=>d.type===N&&i>=d.x&&s>=d.y&&i<d.x+d.width&&s<d.y+d.height)}Object.keys(K).forEach(i=>{let s=K[i];B.push({x:s[0],y:s[1],width:1,height:1,type:"exit",orientation:i})});function he(){for(let i=0;i<5;i++){let s=3+Math.floor(Math.random()*3),N=3+Math.floor(Math.random()*3),d=1+Math.floor((J-s-2)*Math.random()),h=1+Math.floor((j-N-2)*Math.random()),p={x:d,y:h,width:s,height:N,type:"room"};B.some(e=>fe({x:d-1,y:h-1,width:s+2,height:N+2,type:"room"},e))||B.push(p)}}for(let i=0;i<10;i++)he();let $=new jsgraphs.WeightedGraph(B.length*B.length);B.forEach((i,s)=>{B.forEach((N,d)=>{if(s===d)return;let h=Math.sqrt(Math.pow(i.x-N.x,2)+Math.pow(i.y-N.y,2));$.addEdge(new jsgraphs.Edge(s,d,h))})});let ue=new jsgraphs.LazyPrimMST($),Z=ue.mst;for(let i=0;i<Z.length;++i){let s=Z[i],N=s.either(),d=s.other(N);console.log("("+N+", "+d+"): "+s.weight);let h=B[N],p=B[d],e=new PF.Grid(J,j),t=new PF.AStarFinder().findPath(Math.floor(h.x+h.width/2),Math.floor(h.y+h.height/2),Math.floor(p.x+p.width/2),Math.floor(p.y+p.height/2),e);console.log(t),t.forEach((o,r)=>{C(o[0],o[1],"room")&&(B[B.length-1].needDoor=!0),B.push({x:o[0],y:o[1],width:1,height:1,type:"corridor",needDoor:r>0&&!!C(t[r-1][0],t[[r-1]][1],"room")})})}let L=new Array(J).fill(null).map(()=>new Array(j).fill(!1));B.forEach(i=>{for(let s=0;s<i.width;s++)for(let N=0;N<i.height;N++)L[s+i.x][N+i.y]=!0});B=B.filter(i=>i.type==="corridor"?!(C(i.x,i.y,"room")||C(i.x,i.y,"exit")):!0);function X(i){switch(i.type){case"exit":V(i.x,i.y,i.width,i.height),U(i.x,i.y,i.orientation,"door"),m.fillStyle="#000000",m.strokeStyle="#ffffff",m.font="20px sans-serif",m.textAlign="center",m.textBaseline="middle";let s={north:"↑",east:"→",south:"↓",west:"←"};m.strokeText(s[i.orientation],i.x*f+f/2,i.y*f+f/2),m.fillText(s[i.orientation],i.x*f+f/2,i.y*f+f/2);break;case"corridor":se(i.x,i.y,{north:!!C(i.x,i.y-1,"corridor")||!!C(i.x,i.y-1,"exit"),east:!!C(i.x+1,i.y,"corridor")||!!C(i.x+1,i.y,"exit"),south:!!C(i.x,i.y+1,"corridor")||!!C(i.x,i.y+1,"exit"),west:!!C(i.x-1,i.y,"corridor")||!!C(i.x-1,i.y,"exit")});break;case"room":V(i.x,i.y,i.width,i.height);break}}re(0,0,J*f,j*f,Q,3,i=>{let s=Math.floor(i[0]/f),N=Math.floor(i[1]/f);return s<0||s>=J||N<0||N>=j?!1:!!(L[s][N]||s+1<J&&L[s+1][N]||s-1>=0&&L[s-1][N]||N+1<j&&L[s][N+1]||N-1>=0&&L[s][N-1])});B.filter(i=>i.type==="corridor"||i.type==="exit").forEach(X);B.filter(i=>i.type!=="corridor"&&i.type!=="exit").forEach(X);B.filter(i=>i.type==="corridor"&&i.needDoor===!0).forEach(i=>{let s=["open","closed"];C(i.x+1,i.y,"room")&&U(i.x,i.y,"east",s[Math.floor(Math.random()*s.length)]),C(i.x-1,i.y,"room")&&U(i.x,i.y,"west",s[Math.floor(Math.random()*s.length)]),C(i.x,i.y+1,"room")&&U(i.x,i.y,"south",s[Math.floor(Math.random()*s.length)]),C(i.x,i.y-1,"room")&&U(i.x,i.y,"north",s[Math.floor(Math.random()*s.length)])})});export default ce();

</script>
<script src="https://cdn.jsdelivr.net/gh/kchapelier/poisson-disk-sampling@2.3.1/build/poisson-disk-sampling.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/chen0040/js-graph-algorithms/build/jsgraphs.min.js"></script>

<div id="app" style="width: 576px; height: 864px; border: 1px solid gray; display: flex; justify-content: center; align-items: center;">
    <canvas width="576" height="807"></canvas>
</div>

